<?php

namespace app\models;

use Yii;
use yii\base\Model;
use yii\log\Logger;

class RegisterForm extends Model
{
    public $name;
    public $password;
    public $passwordVerify;
    public $sex;
    public $phone;
    public $email;
    public $birth;


    public function attributeLabels()
    {
        return [
            'name' => '用户名',
            'password' => '密码',
            'passwordVerify' => '确认密码',
            'sex' => '性别',
            'phone' => '电话',
            'email' => '邮箱',
            'birth' => '生日',
        ];
    }

    public function rules()
    {
        return [
            [['name', 'password', 'passwordVerify', 'sex', 'phone', 'email', 'birth'], 'required'],
            ['name', 'validateNameExist'],
            ['password', 'validatePassword'],
            ['email', 'email'],
        ];
    }

    public function validateNameExist($attribute, $params) {
        if (!$this->hasErrors()) {
            if (User::findOne($this->name) != null) {
                $this->addError($attribute, '账号已存在');
            }
        }
    }

    public function validatePassword($attribute, $params)
    {
        if (!$this->hasErrors()) {
            if ($this->password != $this->passwordVerify) {
                $this->addError($attribute, '密码不一致');
            }
        }
    }

    public function register()
    {
        $user = new User();
        $user->name = $this->name;
        $user->password = $this->password;
        $user->sex = $this->sex;
        $user->phone = $this->phone;
        $user->email = $this->email;
        $user->birth = $this->birth;
        $user->join_date = "0000-00-00";
        $user->leader_dance_list = "";
        $user->is_vip = 0;
        try {
            $result = $user->insert();
            if ($result === false) {
                Yii::error("insert to db user failed");
            }
            return $result;
        } catch (Exception $e) {
            Yii::error("insert to db user exception:" . $e->getMessage());
            return false;
        }
    }
}
